# æ¬¡ä¸–ä»£å®šåºã€ç”Ÿç‰©è³‡è¨Šå­¸èˆ‡åŸºå› é«”é†«å­¸(II)

## æœ¬æ¬¡èª²ç¨‹ä¸»è¦å…§å®¹
 1. è¤‡è£½èª²ç¨‹æª”æ¡ˆè‡³åœ‹ç¶²ä¸­è‡ªå·±çš„è³‡æ–™å¤¾
 2. sample QC:å°åŸå§‹æ¸¬åºæ•¸æ“šé€²è¡Œå¿«é€Ÿè³ªé‡æ§åˆ¶æª¢æŸ¥ã€‚é€šéQuality Controlç ”ç©¶äººå“¡å¯ä»¥è­˜åˆ¥æ•¸æ“šä¸­çš„æ½›åœ¨å•é¡Œï¼Œå¾è€Œåšå‡ºæ•¸æ“šéæ¿¾ã€ä¿®æ­£çš„æ±ºå®šã€‚åœ¨é«˜é€šé‡æ¸¬åºå¯¦é©—ä¸­ï¼Œè³ªé‡æ§åˆ¶æ˜¯å°åŸå§‹æ¸¬åºæ•¸æ“šé€²è¡Œæª¢æŸ¥å’Œè©•ä¼°çš„éç¨‹ï¼Œä»¥ç¢ºä¿æ•¸æ“šçš„å®Œæ•´æ€§å’Œå¯é æ€§ã€‚


## è¤‡è£½èª²ç¨‹æª”æ¡ˆ
> [!CAUTION]
> â€¼ï¸å› ç‚ºæ˜¯å°‡æª”æ¡ˆè¤‡è£½è‡³åœ‹ç¶²ï¼Œæ‰€ä»¥ä»¥ä¸‹æ­¥é©Ÿçš„æŒ‡ä»¤éƒ½éœ€åœ¨ã€ä½ è‡ªå·±çš„ã€é ç«¯ä¸»æ©Ÿçš„ `/work/{your_username}` è·¯å¾‘ä¸‹ (**è«‹ç¢ºä¿ç¾åœ¨æ˜¯åœ¨è‡ªå·±çš„è·¯å¾‘ä¸‹ï¼ï¼ï¼**)

### step 1 åœ¨åœ‹ç¶²ä¸Šå»ºç«‹è·¯å¾‘
1. ç™»å…¥åœ‹ç¶²ï¼ˆå¿˜è¨˜æ€éº¼ç™»å…¥çš„äººè«‹åƒè¦‹[é€£çµ](https://hackmd.io/jcvG9iIiRW6DTUysi8AKug)ï¼‰
2. é€²å…¥workè³‡æ–™å¤¾è¼¸å…¥`cd /work/username`ï¼Œæ¥è‘—è¼¸å…¥`mkdir result`å¯ä»¥åœ¨åœ‹ç¶²ä¸»æ©Ÿç›®å‰çš„ä½ç½®ä¸‹å»ºç«‹ä¸€å€‹å«åšresultçš„è³‡æ–™å¤¾ï¼Œä½œç‚ºæœ¬æ¬¡ä½œæ¥­æª”æ¡ˆå„²å­˜çš„è³‡æ–™å¤¾
    ```
    cd /work/username
    mkdir result
    ```
3. æ¥è‘—`cd result`åœ¨å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾`mkdir fastqc`å„²å­˜ä¸‹è¼‰çš„sample
    ```
    cd result
    mkdir fastp
    ```

> [!IMPORTANT]
> #### å‘½ä»¤å°å­¸å ‚
> - `mkdir` make directoryï¼Œç”¨ä¾†åœ¨æŒ‡å®šä½ç½®å‰µå»ºä¸€å€‹æ–°çš„ç›®éŒ„ï¼ˆè³‡æ–™å¤¾ï¼‰
> - mkdir çš„ç”¨æ³•: ```mkdir [é¸é …]   #å»ºç«‹ä¸€å€‹æ–°ç›®éŒ„(è³‡æ–™å¤¾)```

4. åœ¨terminalåˆ©ç”¨`rsync`æŒ‡ä»¤ï¼Œå°‡åˆ†ææ‰€éœ€çš„æŒ‡ä»¤(bashæª”)ï¼Œè¤‡è£½åˆ°è‡ªå·±çš„è·¯å¾‘ä¸‹ä½¿ç”¨\
    **â—æ­¤æ­¥é©Ÿä½ éœ€è¦å­¸æœƒå¦‚ä½•å¾åœ‹ç¶²åˆ¥äººçš„è³‡æ–™å¤¾ä¸­è¤‡è£½æª”æ¡ˆåˆ°è‡ªå·±åœ¨åœ‹ç¶²çš„è³‡æ–™å¤¾â—**
    ```
    rsync -avz /work/evelyn92/2026NGS/HW1/fastp.sh ./
    ```

5. å¦å¤–[ä¸‹è¼‰](https://paylong2.tw/nextcloud/index.php/s/NP76ri2MNpoasmq)åˆ†ææ‰€éœ€è³‡æ–™
    ```
    #ä¸‹è¼‰å¯†ç¢¼:NGS112-2
    ```
   >â— **è«‹ä¸‹è¼‰ä»¥ä¸‹å…­å€‹æª”æ¡ˆ!!** (6æ¢readsï¼Œå…±åŒ…å«ä¸‰å€‹sample) \
   > SRR13076392_S14_L002_R1_002.fastq.gz \
   > SRR13076392_S14_L002_R2_002.fastq.gz \
   > SRR13076393_S15_L002_R1_002.fastq.gz \
   > SRR13076393_S15_L002_R2_002.fastq.gz \
   > SRR13076398_S20_L002_R1_002.fastq.gz \
   > SRR13076398_S20_L002_R2_002.fastq.gz
   
6. è«‹ç›´æ¥[ä¸Šå‚³](https://github.com/Jacob-s-Lab/2026_NGS/blob/main/Linux_NCHC.md)  æª”æ¡ˆåˆ°fastp\
    **â—æ­¤æ­¥é©Ÿéœ€è¦å­¸ç¿’çš„å…§å®¹ç‚ºå°‡æª”æ¡ˆå¾æœ¬åœ°ç«¯ä¸Šå‚³è‡³åœ‹ç¶²â—**
    ```
    ä¸Šå‚³æª”æ¡ˆ:rsync -azrvh . ä¸»æ©Ÿå¸³è™Ÿ@t3-c4.nchc.org.tw:/work/ä¸»æ©Ÿå¸³è™Ÿ/result/fastp
    è§£å£“ç¸®æª”æ¡ˆ: unzip <è¦è§£å£“ç¸®çš„æª”å>
    æ”¹æª”å: mv <åŸæœ¬çš„æª”å> <å¾Œä¾†çš„æª”å>
    ```

> [!CAUTION]
> `fastp`ï¼šæ­¤**è³‡æ–™å¤¾**å­˜æ”¾<ins> ä¸‹è¼‰çš„æª”æ¡ˆ (fastqæª”æ¡ˆ) </ins>

> [!IMPORTANT]
> #### æ–‡ä»¶æ ¼å¼ä»‹ç´¹
> - `fastq` : FASTQ æ˜¯ä¸€ç¨®æ–‡ä»¶æ ¼å¼ï¼Œç”¨æ–¼å­˜å„²ç”Ÿç‰©å­¸é ˜åŸŸä¸­é«˜é€šé‡æ¸¬åºæŠ€è¡“ç”Ÿæˆçš„ DNA æˆ– RNA åºåˆ—æ•¸æ“šã€‚é€™ç¨®æ ¼å¼åŒæ™‚åŒ…å«äº†åºåˆ—çš„æ ¸è‹·é…¸åºåˆ—å’Œå°æ‡‰çš„è³ªé‡åˆ†æ•¸
> - `fastp.sh` : æ­¤**æª”æ¡ˆ**ç‚ºåŸ·è¡Œåˆ†ææ‰€éœ€çš„åŸ·è¡Œæª”
     
---------------

# Sample QC
Shell script for running [fastp]([script/fastp.sh](https://github.com/Jacob-s-Lab/2026_NGS/blob/main/script/fastp.sh)).

## Step 1 å»ºç«‹shell script

> [!IMPORTANT]
> #### ç”šéº¼æ˜¯shell script?
> shell  script(ç¨‹å¼åŒ–è‰ç¨¿)
> - ç°¡å–®ä¾†èªªï¼Œæ˜¯åˆ©ç”¨ shell çš„åŠŸèƒ½æ‰€å¯«çš„ä¸€å€‹ã€ç¨‹å¼ (program)ã€ï¼Œé€™å€‹ç¨‹å¼æ˜¯ä½¿ç”¨ç´”æ–‡å­—æª”ï¼Œå°‡ä¸€äº› shell çš„èªæ³•èˆ‡æŒ‡ä»¤(å«å¤–éƒ¨æŒ‡ä»¤)å¯«åœ¨è£¡é¢ï¼Œ æ­é…æ­£è¦è¡¨ç¤ºæ³•ã€ç®¡ç·šå‘½ä»¤èˆ‡è³‡æ–™æµé‡å°å‘ç­‰åŠŸèƒ½ï¼Œä»¥é”åˆ°æˆ‘å€‘æ‰€æƒ³è¦çš„è™•ç†ç›®çš„ï¼Œé€šéç·¨å¯«å’Œä½¿ç”¨ Shell è‰ç¨¿ï¼Œå¯ä»¥æé«˜å·¥ä½œæ•ˆç‡ä¸¦æ¸›å°‘é‡è¤‡æ“ä½œå‘½ä»¤
> - å¯åœ¨ Unixã€Linux æˆ–å…¶ä»–é¡ Unix ç³»çµ±çš„ shell ç’°å¢ƒä¸­é‹è¡Œã€‚æœ€å¸¸ç”¨çš„ shell è‰ç¨¿èªè¨€åŒ…æ‹¬ Bashï¼ˆBourne Again Shellï¼‰ã€Shï¼ˆBourne Shellï¼‰å’Œ Zshï¼ˆZ Shellï¼‰ã€‚

> reference:https://linux.vbird.org/linux_basic/centos7/0340bashshell-scripts.php#script

 
1. é€²å…¥resultè³‡æ–™å¤¾ï¼Œè¼¸å…¥`cd /work/username/result`
2. é€²å…¥shell scriptï¼Œè¼¸å…¥`vim fastqc.sh`

> [!IMPORTANT]
> #### å‘½ä»¤å°å­¸å ‚
> - åœ¨ Unix å’Œ Linux ç³»çµ±ä¸­ï¼Œå‘½ä»¤ `vim fastp.sh` ç”¨æ–¼ä½¿ç”¨ Vim ç·¨è¼¯å™¨æ‰“é–‹æˆ–å‰µå»ºåç‚º `fastp.sh` çš„æ–‡ä»¶ã€‚é€™æ˜¯ä¸€å€‹ç°¡å–®çš„å‘½ä»¤ï¼Œç”¨æ–¼é€²å…¥ Vim ç·¨è¼¯å™¨ä»¥ç·¨è¼¯æŒ‡å®šçš„ Shell Script æ–‡ä»¶ã€‚
> - å…·é«”å«ç¾©
>  * vimï¼šé€™æ˜¯å‘½ä»¤è¡Œæ–‡æœ¬ç·¨è¼¯å™¨ Vim çš„åç¨±ã€‚Vim æ˜¯ä¸€å€‹å¼·å¤§çš„æ–‡æœ¬ç·¨è¼¯å™¨ï¼Œå»£æ³›ç”¨æ–¼ç·¨è¼¯ç¨‹åºä»£ç¢¼å’Œè‰ç¨¿ã€‚
>  * `fastp.sh`ï¼šé€™æ˜¯è¦ç·¨è¼¯çš„æ–‡ä»¶åã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œ`fastp.sh` æ˜¯ä¸€å€‹ Shell Script æ–‡ä»¶ï¼Œæ“´å±•å .sh é€šå¸¸è¡¨ç¤ºé€™æ˜¯ä¸€å€‹ Shell è„šæœ¬æ–‡ä»¶ã€‚
> - åŸ·è¡Œè©²å‘½ä»¤å¾Œçš„è¡Œç‚ºï¼š
>  * å¦‚æœ `fastp.sh` æ–‡ä»¶å·²ç¶“å­˜åœ¨ï¼Œ`vim fastp.sh` æœƒæ‰“é–‹é€™å€‹æ–‡ä»¶ï¼Œå…è¨±ä½ æŸ¥çœ‹å’Œç·¨è¼¯å…¶å…§å®¹ã€‚
>  * å¦‚æœ `fastp.sh` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œ`vim fastp.sh` æœƒå‰µå»ºä¸€å€‹æ–°çš„ç©ºæ–‡ä»¶ï¼Œä¸¦é€²å…¥ Vim ç·¨è¼¯å™¨ä»¥ä¾¿ä½ å¯ä»¥é–‹å§‹ç·¨å¯«è‰ç¨¿ã€‚

  
3. è«‹æŒ‰éµç›¤ <kbd>i</kbd> é€²å…¥ç·¨è¼¯æ¨¡å¼ (åº•ä¸‹æœƒå‡ºç¾"â€“- INSERT â€“-")ï¼Œä¸¦æŠŠä¸Šä¸€æ­¥é©Ÿä¸‹è¼‰çš„shell scipt è²¼åˆ°`fastp.sh`


## Step 2 ä¿®æ”¹åˆ†æåŸ·è¡Œæª”

1. è«‹æ›´æ”¹ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
> ä»¥ä¸‹ç¤ºç¯„æœƒä»¥fastqè³‡æ–™å¤¾ä¸­çš„SEAåšç‚ºç¤ºç¯„ (æ ¼å¼è«‹ä¾ç…§è£¡é¢çµ¦ä½ çš„ç¯„ä¾‹ï¼Œå‰¯æª”åä¸ç”¨å¯«é€²å»)
> 

(1) Slurmæ’ç¨‹è¨­å®š

> [!IMPORTANT]
> #### slurmæ˜¯ç”šéº¼?
> SLURMï¼ˆSimple Linux Utility for Resource Managementï¼‰æ˜¯ä¸€å€‹ç”¨æ–¼å¤§è¦æ¨¡è¨ˆç®—é›†ç¾¤çš„é–‹æºè³‡æºç®¡ç†å™¨å’Œå·¥ä½œè² è¼‰ç®¡ç†å™¨ã€‚å®ƒä¸»è¦ç”¨æ–¼é«˜æ€§èƒ½è¨ˆç®—ï¼ˆHPCï¼‰ç’°å¢ƒï¼Œå¹«åŠ©ç®¡ç†å’Œèª¿åº¦è¨ˆç®—è³‡æºï¼Œå¦‚ CPUã€å…§å­˜å’Œè¨ˆç®—ç¯€é»ã€‚SLURM åœ¨å¤§å‹è¶…ç®—ä¸­å¿ƒã€ç ”ç©¶æ©Ÿæ§‹å’Œä¼æ¥­ä¸­å»£æ³›ä½¿ç”¨ã€‚


  ğŸ‘‰ æ¥ä¸‹ä¾†ä¾ç…§æŒ‡ç¤ºä¿®æ”¹é€™å€‹å€å¡Š (è«‹è¦‹ä¸‹é¢èªªæ˜)ï¼š

  ```
  #!/usr/bin/sh
  #SBATCH -A ACD114093                      # Account name/project number
  #SBATCH -J fastp                          # Job name
  #SBATCH -p ngscourse                      # Partition Name ç­‰åŒPBSè£¡é¢çš„ -q Queue name
  #SBATCH -c 2                              # ä½¿ç”¨çš„coreæ•¸ è«‹åƒè€ƒQueueè³‡æºè¨­å®š
  #SBATCH --mem=13g                         # ä½¿ç”¨çš„è¨˜æ†¶é«”é‡ è«‹åƒè€ƒQueueè³‡æºè¨­å®š
  #SBATCH -o out.log                        # Path to the standard output file
  #SBATCH -e err.log                        # Path to the standard error ouput file
  #SBATCH --mail-user=yourmail@gmail.com    # email
  #SBATCH --mail-type=END                   # æŒ‡å®šé€å‡ºemailæ™‚æ©Ÿ å¯ç‚ºNONE, BEGIN, END, FAIL, REQUEUE, ALL
  ```

(2) ä¿®æ”¹æª”æ¡ˆè·¯å¾‘  
  ```
  # Please enter the R1 & R2 file name and your username
  user=username                        # åœ‹ç¶²å¸³è™Ÿ               
  IN_DIR=/work/${user}/result/fastp    # å­˜æ”¾fastqçš„è³‡æ–™å¤¾è·¯å¾‘
  sample=SRR13076390                   # sampleçš„åç¨±
  R1=${IN_DIR}/${sample}_1.fastq.gz    # R1æ‰€åœ¨çš„æª”æ¡ˆè·¯å¾‘
  R2=${IN_DIR}/${sample}_2.fastq.gz    # R2æ‰€åœ¨çš„æª”æ¡ˆè·¯å¾‘
  ```

(3)å»ºç«‹è³‡æ–™å¤¾(å‘½åç‚º`fastqc_${sample}`)ä¾†å­˜æ”¾fastpçµæœ
  ```
  # output
  OUT_DIR=/work/${user}/result/fastp_${sample}
  mkdir -p ${OUT_DIR}
  ```
    
(4) ä¿®æ”¹åŸ·è¡Œfastpçš„å‘½ä»¤
  ```
  fastp \
  -i ${R1} -I ${R2} \
  -o ${OUT1} -O ${OUT2} \
  -h ${HTML} -j ${JSON} \
  -w 3
  ```
(5)æŒ‰ <kbd>Esc</kbd> é›¢é–‹ç·¨è¼¯æ¨¡å¼  
(6) è¼¸å…¥ `:wq` ä¸¦æŒ‰ä¸‹ <kbd>Enter</kbd> å¯å„²å­˜çµæœ  
**â—è‹¥å‡ºç¾ "E45: 'readonly' option is set (add ! to override)" çš„è©±ï¼Œè«‹è¼¸å…¥`:wq!`ä¾†å„²å­˜ï¼‰â—**

> [!IMPORTANT]
> #### å‘½ä»¤å°å­¸å ‚
> - ```:wq```: ä¿å­˜ä¸¦é€€å‡º    
> æ˜¯åœ¨ Vim ç·¨è¼¯å™¨ä¸­ç”¨ä¾†ä¿å­˜æ–‡ä»¶ä¸¦é€€å‡ºç·¨è¼¯æ¨¡å¼çš„å‘½ä»¤ï¼Œå…ˆæŒ‰ ```Esc``` é€²å…¥å‘½ä»¤æ¨¡å¼ï¼Œç„¶å¾Œè¼¸å…¥ ```:wq``` ä¸¦æŒ‰ä¸‹ Enterã€‚é€™å°‡æœƒä¿å­˜ç•¶å‰æ–‡ä»¶çš„ä¿®æ”¹ä¸¦é€€å‡º Vimã€‚ ```w``` ä»£è¡¨ writeï¼ˆä¿å­˜ï¼‰ï¼Œ ```q``` ä»£è¡¨ quitï¼ˆé€€å‡ºï¼‰
> - ```:wq!```: å¼·åˆ¶ä¿å­˜ä¸¦é€€å‡º    
> å¦‚æœæ–‡ä»¶æ˜¯åªè®€çš„æˆ–è€…æœ‰å…¶ä»–é™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ ```:wq!``` ä¾†å¼·åˆ¶ä¿å­˜ä¸¦é€€å‡ºã€‚ ```!``` æ˜¯å¼·åˆ¶åŸ·è¡Œçš„æ„æ€
> - å¦‚æœä½ åªæƒ³ä¿å­˜æ–‡ä»¶ä½†ä¸é€€å‡ºï¼Œå¯ä»¥ä½¿ç”¨ ```:w```ï¼Œå¦‚æœåªæƒ³é€€å‡ºä½†ä¸ä¿å­˜ï¼Œå¯ä»¥ä½¿ç”¨ ```:q``` æˆ– ```:q!``` (å¼·åˆ¶é€€å‡º)ã€‚

2. åŸ·è¡Œscript

(1)è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œä¾†ä»¥sbatch jobçš„æ–¹å¼é€å‡ºç·¨è¼¯å®Œæˆçš„è‰ç¨¿
```
sbatch fastp.sh
```


> [!IMPORTANT]
> #### å‘½ä»¤å°å­¸å ‚
> ```sbatch``` æ˜¯ SLURM çš„ä¸€å€‹å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ–¼æäº¤ä½œæ¥­è‰ç¨¿åˆ° SLURM ä½œæ¥­èª¿åº¦ç³»çµ±ã€‚é€™äº›è‰ç¨¿é€šå¸¸åŒ…å« SLURM æŒ‡ä»¤å’Œè¦åŸ·è¡Œçš„å‘½ä»¤ã€‚

(2)è‹¥é€å‡ºæˆåŠŸå°‡æœƒå‡ºç¾ä»¥ä¸‹æ–‡å­—(çµæœåœ¨resultè³‡æ–™å¤¾å·²ç¶“æŒ‡å®šå¥½è·¯å¾‘)
```
Submitted batch job ï¼¿ï¼¿ï¼¿
```

(3)å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹å·¥ä½œåŸ·è¡Œæƒ…æ³
```
sacct
```
![image](https://hackmd.io/_uploads/Sk5iLyfYZl.png)


> [!IMPORTANT]
> #### å‘½ä»¤å°å­¸å ‚
> ``sacct`` æ­¤æŒ‡ä»¤ç”¨æ–¼åˆ—å‡ºå¸³è™Ÿçš„ç›¸é—œä»»å‹™æˆ–ä»»å‹™é›†ä¹‹ç‹€æ…‹ï¼Œä¾‹å¦‚é‹è¡Œä¸­ã€å·²çµ‚æ­¢æˆ–æ˜¯å·²å®Œæˆï¼Œæ˜¯æœ€åŸºæœ¬çš„æª¢è¦–ä»»å‹™æŒ‡ä»¤ã€‚å®ƒå¯ä»¥é¡¯ç¤ºä¾‹å¦‚IDã€ä½¿ç”¨è€…ã€ç‹€æ…‹ã€ä½¿ç”¨çš„è³‡æºç­‰è³‡è¨Šï¼Œé€™å€‹å‘½ä»¤å°æ–¼è¿½è¹¤å’Œåˆ†æä½œæ¥­çš„é‹è¡Œæƒ…æ³éå¸¸æœ‰ç”¨ã€‚

3. æŸ¥çœ‹çµæœ  
 `out.log`å’Œ`err.log`ç‚ºåŸ·è¡Œé€™å€‹scriptçš„æ¨™æº–è¼¸å‡ºå’Œæ¨™æº–éŒ¯èª¤ï¼Œå¦‚æœåŸ·è¡Œæ™‚æœ‰å‡ºç¾éŒ¯èª¤ï¼Œå¯ä»¥æŸ¥çœ‹`err.log`(æª”æ¡ˆæœƒåœ¨`/work/username/result/`åº•ä¸‹)
* é€™ä»½åŸ·è¡Œæª”æœƒç”¢ç”Ÿhtmlæª”ï¼Œä¸‹è¼‰å¾Œå³å¯é–‹å•ŸæŸ¥çœ‹fastp Report
* ä¸‹è¼‰è©³æƒ…å¯è¦‹é€£çµ[ä¸‹è¼‰](https://github.com/Jacob-s-Lab/2026_NGS/blob/main/Linux_NCHC.md)
  

